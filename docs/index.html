<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>TestContexts · TestContexts.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">TestContexts.jl</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href="index.html">TestContexts</a><ul class="internal"><li><a class="tocitem" href="#The-global-test-context"><span>The global test context</span></a></li><li><a class="tocitem" href="#Setting-up-the-test-environment"><span>Setting up the test environment</span></a></li><li><a class="tocitem" href="#Running-tests"><span>Running tests</span></a></li><li><a class="tocitem" href="#Controlling-test-execution"><span>Controlling test execution</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="index.html">TestContexts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">TestContexts</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/orenbenkiki/TestContexts.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="TestContexts"><a class="docs-heading-anchor" href="#TestContexts">TestContexts</a><a id="TestContexts-1"></a><a class="docs-heading-anchor-permalink" href="#TestContexts" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="TestContexts.TestContexts" href="#TestContexts.TestContexts"><code>TestContexts.TestContexts</code></a> — <span class="docstring-category">Module</span></header><section><div><p>Run multiple tests in a controlled context.</p><p>This provides the following features which are missing from the default <code>@testset</code> macro:</p><ul><li><p>Test cases are logged using <code>@debug</code>, to make it easier to debug and trace test execution.</p></li><li><p>Test cases can be filtered using regular expression patterns, to allow debugging specific test cases.</p></li><li><p>Each test case starts with a controlled environment whose content is independent from the other test cases. This environment can be created incrementally by nesting test sets, allowing setup/teardown steps to be reused for multiple test cases.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L1-L14">source</a></section></article><h2 id="The-global-test-context"><a class="docs-heading-anchor" href="#The-global-test-context">The global test context</a><a id="The-global-test-context-1"></a><a class="docs-heading-anchor-permalink" href="#The-global-test-context" title="Permalink"></a></h2><p>The global <code>tc</code> object is used to configure and access the tests context.</p><article class="docstring"><header><a class="docstring-binding" id="TestContexts.tc" href="#TestContexts.tc"><code>TestContexts.tc</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>The global context for running tests. This is mainly used to access the test environment; by accessing <code>tc.foo</code> one obtains the value of some <code>foo</code> property which was previously set up by a <code>test_set</code> or by the <code>test_case</code> itself.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L106-L110">source</a></section></article><h2 id="Setting-up-the-test-environment"><a class="docs-heading-anchor" href="#Setting-up-the-test-environment">Setting up the test environment</a><a id="Setting-up-the-test-environment-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-the-test-environment" title="Permalink"></a></h2><p>For the common case when multiple test cases require the same initial data, one can invoke <code>test_set</code>. This works similarly to a &quot;given&quot; or &quot;when&quot; clause in BDD. The data is stored inside the global <code>tc</code> context.</p><article class="docstring"><header><a class="docstring-binding" id="TestContexts.PropertyValue" href="#TestContexts.PropertyValue"><code>TestContexts.PropertyValue</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Possible values for a test property.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L64-L66">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TestContexts.SharedValue" href="#TestContexts.SharedValue"><code>TestContexts.SharedValue</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SharedValue(value::Any)</code></pre><p>A shared value will be used as-is by all tests. If the value is mutable, the test cases are responsible to never change it (or at least ensure the original value is restored by the end of each test).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L38-L44">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TestContexts.PrivateValue" href="#TestContexts.PrivateValue"><code>TestContexts.PrivateValue</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">PrivateValue(make::Function, finalize::Union{Function,Nothing}=nothing)</code></pre><p>A private value will be (lazily) re-created for each test (that accesses it) by invoking the <code>make</code> function. This value can be mutated at will by the test case without affecting any other test case. If the <code>finalize</code> function was specified, it is invoked at the end of each test case (that accessed the value) and is given the value so it can be properly disposed of.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L49-L56">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TestContexts.test_set" href="#TestContexts.test_set"><code>TestContexts.test_set</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">test_set(body::Function, name::String, data...)</code></pre><p>Similar to @testset but uses the global <code>tc</code> test context for running tests under the given <code>name</code>. The optional <code>data</code> must a series of zero or more entries, each in the format <code>property =&gt; value</code> where <code>property</code> is a symbol and <code>value</code> is a <code>PropertyValue</code>.</p><p>Nesting test sets is allowed. This is a common pattern for incrementally setting up a test environment for the actual test cases. In BDD terminology, a test set is similar to the &quot;given&quot; or &quot;when&quot; clauses.</p><p>The property values are not accessible (yet). See <code>test_case</code> for actually accessing the data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L137-L149">source</a></section></article><h2 id="Running-tests"><a class="docs-heading-anchor" href="#Running-tests">Running tests</a><a id="Running-tests-1"></a><a class="docs-heading-anchor-permalink" href="#Running-tests" title="Permalink"></a></h2><p>To actually run tests, invoke <code>test_case</code> (typically nested within one or more <code>test_set</code> calls). Each test case will be logged using <code>@debug</code> before it starts execution.</p><article class="docstring"><header><a class="docstring-binding" id="TestContexts.test_case" href="#TestContexts.test_case"><code>TestContexts.test_case</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">test_case(body::Function, name::String, data...)</code></pre><p>Similar to <code>test_set</code> but is used to wrap actual <code>@test</code> code. Allows access to any data previously setup by the containing <code>test_set</code> calls, if any, or in the <code>test_case</code> call itself. The properties data is available during the test by accessing <code>tc.property</code>. A separate instance is created (lazily) for any private data for each test case. If a <code>finalize</code> function was specified, it is invoked to properly dispose of the data at the end of the test case.</p><p>Nesting a test set or a test case inside a test case is forbidden. That is, a test case is expected to actually test some specific scenario which was set up by the containing test sets. In BDD terminology, a test case is similar to the &quot;then&quot; clause.</p><p>If any <code>test_patterns</code> were specified, and the full <code>test_name</code> does not match any of these patterns, then the test case is silently ignored. Otherwise, the test name is logged using <code>@debug</code> before the test case code is executed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L176-L192">source</a></section></article><h2 id="Controlling-test-execution"><a class="docs-heading-anchor" href="#Controlling-test-execution">Controlling test execution</a><a id="Controlling-test-execution-1"></a><a class="docs-heading-anchor-permalink" href="#Controlling-test-execution" title="Permalink"></a></h2><p>Invoking <code>test_patterns</code> allows specifying a list of patterns of full test names. If this list is not empty, only tests which match at least one of the patterns will actually execute:</p><article class="docstring"><header><a class="docstring-binding" id="TestContexts.test_name" href="#TestContexts.test_name"><code>TestContexts.test_name</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">test_name()::AbstractString</code></pre><p>Return the full name of the current test context. This is a <code>/</code>-separated path containing the names of all the nested <code>test_set</code> and <code>test_case</code> calls. This full name is automatically logged using <code>@debug</code> at the start of each test case. It is also matched against any <code>test_patterns</code> to allow executing only a specific subset of the tests.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L113-L120">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TestContexts.test_patterns" href="#TestContexts.test_patterns"><code>TestContexts.test_patterns</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">test_patterns(patterns::Vector{Union{String,Regex}})::Nothing</code></pre><p>Specify patterns for the tests to run. Only tests whose full <code>test_name</code> matches one of the patterns will be run. If the vector is empty, all tests will be run.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/orenbenkiki/TestContexts.jl/blob/e5b218ee58125e7535ede298ac01e2eb259bff9d/src/TestContexts.jl#L125-L130">source</a></section></article><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>In the following example, we have two test cases, <code>db/filled</code> and <code>db/empty</code>. Each of these test cases starts with a fresh copy of the database, which is deleted when the test case is done.</p><pre><code class="nohighlight hljs">test_set(&quot;db&quot;, :db =&gt; PrivateValue(create_db_on_disk, remove_db_from_disk)) do
    test_case(&quot;filled&quot;) do
        fill_db(tc.db)
        @test !isempty(query_db(tc.db))
    end
    test_case(&quot;empty&quot;) do
        @test isempty(query_db(tc.db))
    end
end</code></pre><p>If we first invoke:</p><pre><code class="nohighlight hljs">test_patterns([&#39;.*/filled&#39;])</code></pre><p>Then running the tests will only execute the <code>db/filled</code> test case. A common usage is to add <code>test_patterns(Base.ARGS)</code> early in <code>runtests.jl</code>, which allows specifying which tests to run on the command line.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.6 on <span class="colophon-date" title="Thursday 23 September 2021 12:00">Thursday 23 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
